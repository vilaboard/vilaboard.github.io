!function(){var o=function(e){return document.getElementById(e)};const t=new URLSearchParams(window.location.search);var i,n=!1,r=this.__canvas=new fabric.Canvas("c",{isDrawingMode:!0,isPanning:!1,isFullScreen:!1,selectedFill:"#"+t.get("f")||"#000000",selectedStrokeColor:"#"+t.get("s")||"#000000",selectedStroke:2,selectedFont:"sans-serif",undo:[],redo:[],teachingmode:!0,backgroundImage:null,clipboard:null,backgroundVpt:!1,pointer:"crosshair",files:[],grid:{stroke:"#00000022",delta:15,svg:null,vertical:!0,horizontal:!0,padding:15}});function l(){return}function c(e){var t=e.target.getAttribute("obj");let i=e.target.getAttribute("value");e.target.value&&(i=e.target.value);const n=r.getActiveObject();null!=t&&null!=i&&("fill"===t&&(r.selectedFill=i,n&&n.set("fill",r.selectedFill),r.freeDrawingBrush.color=r.selectedFill),"stroke"===t&&(r.selectedStrokeColor=i,n&&n.set("stroke",r.selectedStrokeColor),r.freeDrawingBrush.color=r.selectedStrokeColor),"strokeWidth"===t&&(r.selectedStroke=parseInt(i,10),n&&n.set("strokeWidth",r.selectedStroke),r.freeDrawingBrush.width=r.selectedStroke+1,o("swi").value=i),"fontFamily"===t&&(r.selectedFont=i,n&&n.set("fontFamily",r.selectedFont)),r.renderAll())}r.setZoom(1),r.setDimensions({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),fabric.Image.fromURL("/imgs/"+t.get("back"),function(e){r.backgroundImage=e,r.backgroundImage&&r.setBackgroundImage(r.backgroundImage,r.renderAll.bind(r),{scaleX:r.width/r.backgroundImage.width,scaleY:r.height/r.backgroundImage.height,backgroundImageStretch:!0})}),r.grid.padding=10,r.grid.delta=100,l(),document.addEventListener("keydown",function(e){const t=r.getActiveObject();if(!(t&&"isEditing"in t&&t.isEditing)){var i=e.key;if("Delete"===i){const n=r.getActiveObjects();n.forEach(e=>{r.remove(e)}),r.requestRenderAll()}if(e.ctrlKey&&"g"===i){if(!t)return;if("activeSelection"!==t.type)return;t.toGroup()}if(e.ctrlKey&&"z"===i){const o=r.undo.pop();void 0!==o&&o.undo()}e.ctrlKey&&"c"===i&&t.clone(function(e){r.clipboard=e}),e.ctrlKey&&"x"===i&&(t.clone(function(e){r.clipboard=e}),r.remove(t)),e.ctrlKey&&"v"===i&&null!==r.clipboard&&(r.clipboard.top+=10,r.clipboard.left+=10,r.clipboard.clone(function(e){r.add(e),r.setActiveObject(e),r.requestRenderAll(),r.isDrawingMode=!1}))}}),window.addEventListener("resize",function(){console.log(window.innerWidth,window.innerHeight),r.setDimensions({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),r.backgroundImage&&(r.backgroundImage.scaleX=r.width/r.backgroundImage.width,r.backgroundImage.scaleY=r.height/r.backgroundImage.height),function(){var e=r.width,t=r.height;if(r.grid.svg){if(e<r.grid.svg.width&&t<r.grid.svg.height)return;r.remove(r.grid.svg),r.grid.svg=null}l()}(),r.requestRenderAll()}),document.addEventListener("wheel",e=>{e.preventDefault();var t=r.getZoom();e.deltaY<0&&t<10&&r.setZoom(1.1*t),0<e.deltaY&&.3<t&&r.setZoom(.9*t),r.grid.svg.set("scaleY",1/t),r.grid.svg.set("scaleX",1/t),r.grid.svg.set("top",0),r.grid.svg.set("left",0),console.log(t,1/t,r.grid.svg.scaleX,r.grid.svg.scaleX),r.requestRenderAll()}),r.on("mouse:up",function(e){n=!1,r.selection=!0}),r.on("mouse:down",function(e){n=r.isPanning}),r.on("mouse:move",function(e){n&&e&&e.e&&(r.selection=!1,e=new fabric.Point(e.e.movementX,e.e.movementY),r.relativePan(e))}),fabric.Object.prototype.transparentCorners=!1,o("upl").onchange=i=>{if(console.log(i.target),0<i.target.files.length)for(let t=0;t<i.target.files.length;t++){let e=new FileReader;e.onload=e=>{url=e.target.result;new fabric.Image.fromURL(url,e=>{e.top=r.height/2,e.left=r.width/2;var t=r.width*e.width/(e.height*e.width);e.scaleX=1/t,e.scaleY=1/t,r.add(e),r.setActiveObject(e),r.isDrawingMode=!1})},e.readAsDataURL(i.target.files[t])}},o("txt").onclick=function(){r.isDrawingMode=!1;let e=new fabric.Textbox("",{fill:r.selectedFill,fontFamily:r.selectedFont,top:r.height/2,left:r.width/2,width:100,isEditing:!0,shadow:null});r.teachingmode&&e.setControlsVisibility({bl:!1,tl:!1,tr:!1,ml:!1,mb:!1,mt:!1,mtr:!1}),r.add(e),r.setActiveObject(e),e.exitEditing(),e.enterEditing()},o("exp").onclick=function(){this.href=r.toDataURL({format:"png",quality:.8,width:r.width,height:r.height}),this.download=(new Date).getTime()+".png"},o("select").onclick=function(){r.isDrawingMode=!1,r.isPanning=!1},o("draw").onclick=function(){r.isDrawingMode=!0,r.isPanning=!1},o("hand").onclick=function(){r.isDrawingMode=!1,r.isPanning=!0},o("new").onclick=()=>{r.remove(...r.getObjects().concat()),r.setZoom(1),l(),r.requestrenderAll()},o("del").onclick=()=>{const e=r.getActiveObjects();e.forEach(e=>{r.remove(e)}),r.requestRenderAll()},window.onclick=e=>{c(e)},o("swi").onchange=e=>{c(e)},o("circle").onclick=()=>{var e=new fabric.Circle({radius:100,fill:r.selectedFill+"88",stroke:r.selectedStrokeColor||"#000000",strokeWidth:r.selectedStroke,top:r.height/2,left:r.width/2});r.add(e),r.setActiveObject(e),r.requestRenderAll(),r.isDrawingMode=!1},o("square").onclick=()=>{var e=new fabric.Rect({width:100,height:100,fill:r.selectedFill+"88",stroke:r.selectedStrokeColor||"#000000",strokeWidth:r.selectedStroke,top:r.height/2,left:r.width/2});r.add(e),r.setActiveObject(e),r.requestRenderAll(),r.isDrawingMode=!1},r.on("object:modified",()=>{r.undo.push({undo:()=>r.remove(e.target),redo:()=>r.add(e.target)})}),r.on("object:added",e=>{r.undo.push({undo:()=>{e.target.vilaundo=!0,r.remove(e.target)},redo:()=>{r.add(e.target)}})}),r.on("object:removed",e=>{r.undo.push({undo:()=>r.add(e.target),redo:()=>r.remove(e.target)})}),r.freeDrawingBrush=new fabric.PencilBrush(r,{statefullCache:!0,decimate:8}),r.freeDrawingBrush&&((i=r.freeDrawingBrush).color="#000000",i.getPatternSrc&&(i.source=i.getPatternSrc.call(i)),i.width=2,i.shadow=new fabric.Shadow({blur:5,offsetX:3,offsetY:3,affectStroke:!0,color:"#00000022"}))}(),window.addEventListener("load",function(){var e=this.__canvas||this.canvas,t=this.__canvases||this.canvases;if(e&&e.calcOffset&&e.calcOffset(),t&&t.length)for(var i=0,n=t.length;i<n;i++)t[i].calcOffset()});