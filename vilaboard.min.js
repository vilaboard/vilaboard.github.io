!function(){var t=function(e){return document.getElementById(e)};const o=window.location.search,n=new URLSearchParams(o);var r=this.__canvas=new fabric.Canvas("c",{isDrawingMode:!0,isFullScreen:!1,selectedFill:"#000000",selectedStrokeColor:"#000000",selectedStroke:2,undo:[],redo:[],teachingmode:!0,backgroundImage:null,clipboard:null,backgroundImage:null});if(r.setDimensions({width:window.innerWidth,height:window.innerHeight-60}),document.body.style.backgroundImage='url("/imgs/'+n.get("back")+'")',document.addEventListener("keydown",function(e){const t=e.key;if("Delete"===t){const e=r.getActiveObjects();console.log(e),e.forEach(e=>{r.remove(e)}),r.requestRenderAll()}if(e.ctrlKey&&"z"===t){const e=r.undo.pop();void 0!==e&&e.undo()}if(e.ctrlKey&&"c"===t&&r.getActiveObject().clone(function(e){r.clipboard=e}),e.ctrlKey&&"x"===t){const e=r.getActiveObject();e.clone(function(e){r.clipboard=e}),r.remove(e)}e.ctrlKey&&"v"===t&&(null!==r.clipboard&&(r.clipboard.top+=10,r.clipboard.left+=10,r.clipboard.clone(function(e){r.add(e),r.setActiveObject(e),r.requestRenderAll(),r.isDrawingMode=!1})))}),window.addEventListener("resize",function(){console.log(window.innerWidth,window.innerHeight),r.setDimensions({width:window.innerWidth-5,height:window.innerHeight-60}),document.body.style.backgroundImage='url("imgs/'+n.get("back")+'")',document.body.style.backgroundSize='100% 100%cx="10px"cx="10px"cx="10px"',r.requestRenderAll()}),fabric.Object.prototype.transparentCorners=!1,t("addtextbt").onclick=function(){r.isDrawingMode=!1;var e=new fabric.Textbox(t("addtext").value,{fill:r.selectedFill,fontFamily:"sans-serif",statefullCache:!0});r.teachingmode&&e.setControlsVisibility({bl:!1,tl:!1,tr:!1,ml:!1,mb:!1,mt:!1,mtr:!1}),r.add(e)},t("select").onclick=function(){r.isDrawingMode=!1},t("draw").onclick=function(){r.isDrawingMode=!0},t("new").onclick=(()=>{r.remove(...r.getObjects().concat()),r.renderAll()}),t("del").onclick=(()=>{const e=r.getActiveObject();r.remove(e)}),window.onclick=(e=>{const t=e.target.getAttribute("obj"),o=e.target.getAttribute("value"),n=r.getActiveObject();console.log(e.target,t,o),null!=t&&null!=o&&("fill"===t&&(r.selectedFill=o,n&&n.set("fill",r.selectedFill),r.freeDrawingBrush.color=r.selectedFill),"stroke"===t&&(r.selectedStrokeColor=o,n&&n.set("stroke",r.selectedStrokeColor),r.freeDrawingBrush.width=r.selectedStroke),"strokeWidth"===t&&(r.selectedStroke=parseInt(o,10)||1,n&&n.set("strokeWidth",r.selectedStroke),r.freeDrawingBrush.width=r.selectedStroke),r.renderAll())}),t("circle").onclick=(()=>{const e=new fabric.Circle({radius:100,fill:r.selectedFill+"88",stroke:"#FF2E62",strokeWidth:r.selectedStroke});r.add(e),r.setActiveObject(e),r.requestRenderAll(),r.isDrawingMode=!1}),t("square").onclick=(()=>{const e=new fabric.Rect({width:100,height:100,fill:r.selectedFill+"88",stroke:"#FF2E62",strokeWidth:r.selectedStroke});r.add(e),r.setActiveObject(e),r.requestRenderAll(),r.isDrawingMode=!1}),r.on("object:modified",()=>{r.undo.push({undo:()=>r.remove(e.target),redo:()=>r.add(e.target)})}),r.on("object:added",e=>{r.undo.push({undo:()=>{e.target.vilaundo=!0,r.remove(e.target)},redo:()=>{r.add(e.target)}})}),r.on("object:removed",e=>{r.undo.push({undo:()=>r.add(e.target),redo:()=>r.remove(e.target)})}),r.freeDrawingBrush=new fabric.PencilBrush(r,{statefullCache:!0}),r.freeDrawingBrush){var c=r.freeDrawingBrush;c.color="#000000",c.getPatternSrc&&(c.source=c.getPatternSrc.call(c)),c.width=2,c.shadow=new fabric.Shadow({blur:5,offsetX:3,offsetY:3,affectStroke:!0,color:"#00000022"})}}(),window.addEventListener("load",function(){var e=this.__canvas||this.canvas,t=this.__canvases||this.canvases;if(e&&e.calcOffset&&e.calcOffset(),t&&t.length)for(var o=0,n=t.length;o<n;o++)t[o].calcOffset()});